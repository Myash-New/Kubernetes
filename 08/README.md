# –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ –∫ –∑–∞–Ω—è—Ç–∏—é ¬´–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Kubernetes¬ª

### –¶–µ–ª—å –∑–∞–¥–∞–Ω–∏—è

–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∫–ª–∞—Å—Ç–µ—Ä—É –ø–æ–¥ –ø—Ä–æ–µ–∫—Ç

------

### –ó–∞–¥–∞–Ω–∏–µ. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç—Ä–µ–±—É–µ–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã
–ò–∑–≤–µ—Å—Ç–Ω–æ, —á—Ç–æ –ø—Ä–æ–µ–∫—Ç—É –Ω—É–∂–Ω—ã –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, —Å–∏—Å—Ç–µ–º–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è, –∞ —Å–∞–º–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –±–µ–∫–µ–Ω–¥–∞ –∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞. –û–ø–∏—à–∏—Ç–µ, –∫–∞–∫–∏–µ —Ä–µ—Å—É—Ä—Å—ã –Ω—É–∂–Ω—ã, –µ—Å–ª–∏ –∏–∑–≤–µ—Å—Ç–Ω–æ:

1. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É–ø–∞–∫–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ —á–∞—Ä—Ç –¥–ª—è –¥–µ–ø–ª–æ—è –≤ —Ä–∞–∑–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è. 
2. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ–π. –ü–æ—Ç—Ä–µ–±–ª—è–µ—Ç 4 –ì–ë –û–ó–£ –≤ —Ä–∞–±–æ—Ç–µ, 1 —è–¥—Ä–æ. 3 –∫–æ–ø–∏–∏. 
3. –ö–µ—à –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤—ã–π. –ü–æ—Ç—Ä–µ–±–ª—è–µ—Ç 4 –ì–ë –û–ó–£ –≤ —Ä–∞–±–æ—Ç–µ, 1 —è–¥—Ä–æ. 3 –∫–æ–ø–∏–∏. 
4. –§—Ä–æ–Ω—Ç–µ–Ω–¥ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–Ω–µ—à–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã –±—ã—Å—Ç—Ä–æ, –æ—Ç–¥–∞–≤–∞—è —Å—Ç–∞—Ç–∏–∫—É. –ü–æ—Ç—Ä–µ–±–ª—è–µ—Ç –Ω–µ –±–æ–ª–µ–µ 50 –ú–ë –û–ó–£ –Ω–∞ –∫–∞–∂–¥—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä, 0.2 —è–¥—Ä–∞. 5 –∫–æ–ø–∏–π. 
5. –ë–µ–∫–µ–Ω–¥ –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç 600 –ú–ë –û–ó–£ –∏ –ø–æ 1 —è–¥—Ä—É –Ω–∞ –∫–æ–ø–∏—é. 10 –∫–æ–ø–∏–π.

### **–†–µ—à–µ–Ω–∏–µ**

### üß© –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 4 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:
1. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**
2. **–°–∏—Å—Ç–µ–º–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è**
3. **–§—Ä–æ–Ω—Ç–µ–Ω–¥** 
4. **–ë—ç–∫–µ–Ω–¥** 

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç —É–ø–∞–∫–æ–≤–∞–Ω–æ –≤ Helm-—á–∞—Ä—Ç –¥–ª—è –¥–µ–ø–ª–æ—è –≤ —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö (dev, stage, prod).

##  1. –†–∞—Å—á—ë—Ç —Ä–µ—Å—É—Ä—Å–æ–≤ –ø–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º
|-------------------------------------------------------------------------------------------------|
| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç       | –ö–æ–ª-–≤–æ —Ä–µ–ø–ª–∏–∫ | CPU –Ω–∞ —Ä–µ–ø–ª–∏–∫—É | RAM –Ω–∞ —Ä–µ–ø–ª–∏–∫—É | –û–±—â–∏–π CPU   | –û–±—â–∞—è RAM     |
|-----------------|---------------|----------------|----------------|-------------|---------------|
| **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** | 3             | 1 —è–¥—Ä–æ         | 4 –ì–ë           | 3 —è–¥—Ä–∞      | 12 –ì–ë         |
| **–ö–µ—à**         | 3             | 1 —è–¥—Ä–æ         | 4 –ì–ë           | 3 —è–¥—Ä–∞      | 12 –ì–ë         |
| **–§—Ä–æ–Ω—Ç–µ–Ω–¥**    | 5             | 0.2 —è–¥—Ä–∞       | 50 –ú–ë          | 1 —è–¥—Ä–æ      | 250 –ú–ë        |
| **–ë—ç–∫–µ–Ω–¥**      | 10            | 1 —è–¥—Ä–æ         | 600 –ú–ë         | 10 —è–¥–µ—Ä     | 6 –ì–ë          |
| **–ò–¢–û–ì–û**       |               |                |                | **17 —è–¥–µ—Ä** | **~30.25 –ì–ë** |
|-------------------------------------------------------------------------------------------------|

##  2. –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∏ –∑–∞–ø–∞—Å

–ó–∞–ø–∞—Å –Ω–∞ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å (1 –Ω–æ–¥–∞): –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ—Å—É—Ä—Å—ã, —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω—ã–µ –æ–¥–Ω–æ–π –Ω–æ–¥–µ.

–ó–∞–ø–∞—Å –Ω–∞ –ø–∏–∫–æ–≤—É—é –Ω–∞–≥—Ä—É–∑–∫—É –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: –î–æ–±–∞–≤–ª—è–µ–º ~20% –∫ —Å—É–º–º–∞—Ä–Ω—ã–º —Ä–µ—Å—É—Ä—Å–∞–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

### –†–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –∑–∞–ø–∞—Å–∞:

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ + 20% –∑–∞–ø–∞—Å:
RAM: 30.25 –ì–ë * 1.2 = 36.3 –ì–ë
CPU: 17 —è–¥–µ—Ä * 1.2 = 20.4 —è–¥—Ä–∞

–°–ª—É–∂–µ–±–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã –Ω–∞ –Ω–æ–¥—É: (kubelet, containerd, kube-proxy, DaemonSets: logging/monitoring/network)
    RAM: 300 –ú–ë
    CPU: 0.1 —è–¥—Ä–∞

–î–æ–±–∞–≤–ª—è–µ–º —Ä–µ—Å—É—Ä—Å—ã –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–Ω–∞ –∫–∞–∂–¥—É—é –Ω–æ–¥—É).

## 3. –í—ã–±–æ—Ä–∞–µ–º —Ç–∏–ø –∏ —Ä–∞–∑–º–µ—Ä –Ω–æ–¥
 –ë—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–Ω–æ—Ä–æ–¥–Ω—ã–µ –Ω–æ–¥—ã –¥–ª—è —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏–∏.
  
–î–ª—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ —Ä–µ–ø–ª–∏–∫–∏ –ë–î –∏ –ö–µ—à(StatefulSet) - —Ä–∞–∑–Ω–µ—Å–µ–º –Ω–∞ —Ä–∞–∑–Ω—ã–µ –Ω–æ–¥—ã, —Ç—Ä–µ–±—É–µ—Ç—Å—è 3 –Ω–æ–¥—ã –¥–ª—è 3—Ö —Ä–µ–ø–ª–∏–∫.
  
  –í–æ–∑—å–º–µ–º —Ä–∞–∑–º–µ—Ä –Ω–æ–¥—ã: 4 vCPU, 16 –ì–ë RAM

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–ª—É–∂–µ–±–Ω—ã—Ö, –æ—Å—Ç–∞–Ω–µ—Ç—Å—è:
    RAM: 16 –ì–ë - 0.3 –ì–ë = 15.7 –ì–ë
    CPU: 4 —è–¥—Ä–∞ - 0.1 —è–¥—Ä–∞ = 3.9 —è–¥—Ä–∞

## 4. –†–∞—Å—á–µ—Ç —Ç—Ä–µ–±—É–µ–º–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –Ω–æ–¥
  
–ë–µ–∑ –∑–∞–ø–∞—Å–∞:
    RAM: 36.3 / 15.7 ‚âà 2.31 -> 3 –Ω–æ–¥—ã
    CPU: 20.4 / 3.9 ‚âà 5.23 -> **6 –Ω–æ–¥**

–ò—Ç–æ–≥ –±–µ–∑ –∑–∞–ø–∞—Å–∞: –ù–∞–∏–±–æ–ª—å—à–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ —Ä–∞—Å—á–µ—Ç–æ–≤ - 6 –Ω–æ–¥.

–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∞—Å–∞ –Ω–∞ –≤—ã—Ö–æ–¥ –Ω–æ–¥—ã –∏–∑ —Å—Ç—Ä–æ—è:
  
  –¢—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–ø–∞—Å –Ω–∞ —Ä–µ—Å—É—Ä—Å—ã –æ–¥–Ω–æ–π –Ω–æ–¥—ã (15.7 –ì–ë RAM, 3.9 —è–¥—Ä–∞ CPU).
   –ù–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ RAM: 36.3 –ì–ë + 15.7 –ì–ë = 52 –ì–ë
   –ù–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ CPU: 20.4 —è–¥—Ä–∞ + 3.9 —è–¥—Ä–∞ = 24.3 —è–¥—Ä–∞

    –†–∞—Å—á–µ—Ç:
       RAM: 52 / 15.7 ‚âà 3,31 -> 4 –Ω–æ–¥—ã
       CPU: 24.3 / 3.9 ‚âà 6.23 -> **7 –Ω–æ–¥** 

# –ò—Ç–æ–≥ —Å –∑–∞–ø–∞—Å–æ–º: 
    
    * –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–±–æ—á–∏—Ö –Ω–æ–¥: 7

    * –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∫–∞–∂–¥–æ–π —Ä–∞–±–æ—á–µ–π –Ω–æ–¥—ã:

        vCPU (—è–¥—Ä–∞): 4

        RAM: 16 –ì–ë




  






3. –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–¥

<details>
  <summary>Chart.yaml</summary>
  
```
apiVersion: v2
name: myapp
version: 1.0.0
appVersion: "1.0"
description: Helm chart for deploying frontend, backend, and database
type: application
```
</details>

<details>
  <summary>values.yaml</summary>
  
```
images:
  frontend:
    repository: nginx
    tag: 1.25
  backend:
    repository: mycompany/api-server
    tag: 1.4.0
  database:
    repository: postgres
    tag: 15

frontend:
  replicas: 2
  port: 80

backend:
  replicas: 2
  port: 8080

database:
  replicas: 1
  port: 5432
  dataDir: /var/lib/postgresql/data
  storage:
    size: 10Gi
```
</details>

<details>
  <summary>values-dev.yaml</summary>
  
```
images:
  frontend:
    tag: latest
  backend:
    tag: dev-latest
  database:
    tag: 15-alpine

frontend:
  replicas: 1
backend:
  replicas: 1
```
</details>

<details>
  <summary>templates/frontend-deployment.yaml</summary>
  
```
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ .Release.Name }}-frontend
  labels:
    {{- include "myapp.labels" . | nindent 4 }}
spec:
  replicas: {{ .Values.frontend.replicas }}
  selector:
    matchLabels:
      app: {{ .Release.Name }}-frontend
  template:
    metadata:
      labels:
        app: {{ .Release.Name }}-frontend
    spec:
      containers:
      - name: frontend
        image: "{{ .Values.images.frontend.repository }}:{{ .Values.images.frontend.tag }}"
        ports:
        - containerPort: {{ .Values.frontend.port }}
        resources: {}
```
</details>

<details>
  <summary>templates/backend-deployment.yaml</summary>
  
```
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ .Release.Name }}-backend
  labels:
    {{- include "myapp.labels" . | nindent 4 }}
spec:
  replicas: {{ .Values.backend.replicas }}
  selector:
    matchLabels:
      app: {{ .Release.Name }}-backend
  template:
    metadata:
      labels:
        app: {{ .Release.Name }}-backend
    spec:
      containers:
      - name: backend
        image: "{{ .Values.images.backend.repository }}:{{ .Values.images.backend.tag }}"
        ports:
        - containerPort: {{ .Values.backend.port }}
        env:
        - name: DATABASE_URL
          value: "postgresql://{{ .Release.Name }}-database:5432/myapp"
        resources: {}
```
</details>

<details>
  <summary>templates/database-statefulset.yaml</summary>
  
```
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: {{ .Release.Name }}-database
  labels:
    {{- include "myapp.labels" . | nindent 4 }}
spec:
  serviceName: {{ .Release.Name }}-database
  replicas: {{ .Values.database.replicas }}
  selector:
    matchLabels:
      app: {{ .Release.Name }}-database
  template:
    metadata:
      labels:
        app: {{ .Release.Name }}-database
    spec:
      containers:
      - name: postgres
        image: "{{ .Values.images.database.repository }}:{{ .Values.database.tag }}"
        ports:
        - containerPort: {{ .Values.database.port }}
        env:
        - name: POSTGRES_DB
          value: myapp
        - name: POSTGRES_USER
          value: admin
        - name: POSTGRES_PASSWORD
          value: password
        volumeMounts:
        - name: data-volume
          mountPath: {{ .Values.database.dataDir }}
  volumeClaimTemplates:
  - metadata:
      name: data-volume
    spec:
      accessModes: ["ReadWriteOnce"]
      resources:
        requests:
          storage: {{ .Values.database.storage.size }}
```
</details>


<details>
  <summary>_helpers.tpl</summary>
  
```
{{/*
Common labels
*/}}
{{- define "myapp.labels" -}}
app: {{ .Chart.Name }}
chart: {{ .Chart.Name }}-{{ .Chart.Version }}
release: {{ .Release.Name }}
heritage: {{ .Release.Service }}
{{- end }}
```
</details>

![01](https://github.com/Myash-New/Kubernetes/blob/main/07/01.jpg)

------
### –ó–∞–¥–∞–Ω–∏–µ 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–≤–µ –≤–µ—Ä—Å–∏–∏ –≤ —Ä–∞–∑–Ω—ã—Ö –Ω–µ–π–º—Å–ø–µ–π—Å–∞—Ö

1. –ü–æ–¥–≥–æ—Ç–æ–≤–∏–≤ —á–∞—Ä—Ç, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –µ–≥–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å. –ó–∞–ø—É—Å—Ç–∏—Çe –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–ø–∏–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
2. –û–¥–Ω—É –≤–µ—Ä—Å–∏—é –≤ namespace=app1, –≤—Ç–æ—Ä—É—é –≤–µ—Ä—Å–∏—é –≤ —Ç–æ–º –∂–µ –Ω–µ–π–º—Å–ø–µ–π—Å–µ, —Ç—Ä–µ—Ç—å—é –≤–µ—Ä—Å–∏—é –≤ namespace=app2.
3. –ü—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

### **–†–µ—à–µ–Ω–∏–µ**

![02](https://github.com/Myash-New/Kubernetes/blob/main/07/02.jpg)
![03](https://github.com/Myash-New/Kubernetes/blob/main/07/03.jpg)