# Домашнее задание к занятию «Компоненты Kubernetes»

### Цель задания

Рассчитать требования к кластеру под проект

------

### Задание. Необходимо определить требуемые ресурсы
Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:

1. Необходимо упаковать приложение в чарт для деплоя в разные окружения. 
2. База данных должна быть отказоустойчивой. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии. 
3. Кеш должен быть отказоустойчивый. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии. 
4. Фронтенд обрабатывает внешние запросы быстро, отдавая статику. Потребляет не более 50 МБ ОЗУ на каждый экземпляр, 0.2 ядра. 5 копий. 
5. Бекенд потребляет 600 МБ ОЗУ и по 1 ядру на копию. 10 копий.

### **Решение**

### Архитектура приложения

Приложение состоит из 4 компонентов:
1. **База данных**
2. **Система кеширования**
3. **Фронтенд** 
4. **Бэкенд** 


##  1. Расчёт ресурсов по компонентам

| Компонент       | Кол-во реплик | CPU на реплику | RAM на реплику | Общий CPU   | Общая RAM     |
|-----------------|---------------|----------------|----------------|-------------|---------------|
| **База данных** | 3             | 1 ядро         | 4 ГБ           | 3 ядра      | 12 ГБ         |
| **Кеш**         | 3             | 1 ядро         | 4 ГБ           | 3 ядра      | 12 ГБ         |
| **Фронтенд**    | 5             | 0.2 ядра       | 50 МБ          | 1 ядро      | 250 МБ        |
| **Бэкенд**      | 10            | 1 ядро         | 600 МБ         | 10 ядер     | 6 ГБ          |
| **ИТОГО**       |               |                |                | **17 ядер** | **~30.25 ГБ** |

##  2. Отказоустойчивость и запас

Запас на отказоустойчивость (1 нода): Добавляем ресурсы, эквивалентные одной ноде.

Запас на пиковую нагрузку и обновления: Добавляем ~20% к суммарным ресурсам приложения.

### Расчет с учетом запаса:

Приложение + 20% запас:

RAM: 30.25 ГБ * 1.2 = 36.3 ГБ

CPU: 17 ядер * 1.2 = 20.4 ядра

Служебные ресурсы на ноду: (kubelet, containerd, kube-proxy, DaemonSets: logging/monitoring/network)

    RAM: 300 МБ

    CPU: 0.1 ядра

Добавляем ресурсы на системные компоненты на каждую ноду.

## 3. Выбораем тип и размер нод
Будем использовать однородные ноды для унификации.
  
Для отказоустойчивости реплики БД и Кеш(StatefulSet) - разнесем на разные ноды, требуется 3 ноды для 3х реплик.
  
Возьмем размер ноды: 4 vCPU, 16 ГБ RAM

После установки служебных, останется:

    RAM: 16 ГБ - 0.3 ГБ = 15.7 ГБ

    CPU: 4 ядра - 0.1 ядра = 3.9 ядра

## 4. Расчет требуемого количества нод
  
  #### Без запаса:

  RAM: 36.3 / 15.7 ≈ 2.31 -> 3 ноды

  CPU: 20.4 / 3.9 ≈ 5.23 -> **6 нод**

Итог без запаса: Наибольшее значение из расчетов - 6 нод.

Добавление запаса на выход ноды из строя:
  
  Требуется запас на ресурсы одной ноды (15.7 ГБ RAM, 3.9 ядра CPU).

   Новое значение RAM: 36.3 ГБ + 15.7 ГБ = 52 ГБ
  
   Новое значение CPU: 20.4 ядра + 3.9 ядра = 24.3 ядра

  #### Расчет:

  RAM: 52 / 15.7 ≈ 3,31 -> 4 ноды

  CPU: 24.3 / 3.9 ≈ 6.23 -> **7 нод** 

# Итог с запасом: 
    
  * Количество рабочих нод: 7
  * Характеристики каждой рабочей ноды:

    vCPU (ядра): 4
    RAM: 16 ГБ
